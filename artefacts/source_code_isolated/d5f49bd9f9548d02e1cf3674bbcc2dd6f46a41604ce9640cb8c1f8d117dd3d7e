public void waitForCallbacks(){
    if (Thread.currentThread() == mLooper.getThread()) {
        throw new IllegalStateException("Must not call this method on callback thread");
    }
    final CountDownLatch latch = new CountDownLatch(1);
    mCallbackHandler.post(new Runnable() {

        @Override
        public void run() {
            latch.countDown();
        }
    });
    try {
        latch.await();
    } catch (InterruptedException e) {
        Slog.wtf(TAG, "Interrupted while waiting for unsolicited response handling", e);
    }
}