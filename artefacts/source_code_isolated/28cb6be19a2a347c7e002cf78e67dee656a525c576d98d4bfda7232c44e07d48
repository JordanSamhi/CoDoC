public MtpEvent readEvent(@Nullable CancellationSignal signal) throws IOException{
    final int handle = native_submit_event_request();
    Preconditions.checkState(handle >= 0, "Other thread is reading an event.");
    if (signal != null) {
        signal.setOnCancelListener(new CancellationSignal.OnCancelListener() {

            @Override
            public void onCancel() {
                native_discard_event_request(handle);
            }
        });
    }
    try {
        return native_reap_event_request(handle);
    } finally {
        if (signal != null) {
            signal.setOnCancelListener(null);
        }
    }
}