public static Icon createFromStream(InputStream stream) throws IOException{
    DataInputStream inputStream = new DataInputStream(stream);
    final int version = inputStream.readInt();
    if (version >= VERSION_STREAM_SERIALIZER) {
        final int type = inputStream.readByte();
        switch(type) {
            case TYPE_BITMAP:
                return createWithBitmap(BitmapFactory.decodeStream(inputStream));
            case TYPE_ADAPTIVE_BITMAP:
                return createWithAdaptiveBitmap(BitmapFactory.decodeStream(inputStream));
            case TYPE_DATA:
                final int length = inputStream.readInt();
                final byte[] data = new byte[length];
                inputStream.read(data, 0, length);
                return createWithData(data, 0, length);
            case TYPE_RESOURCE:
                final String packageName = inputStream.readUTF();
                final int resId = inputStream.readInt();
                return createWithResource(packageName, resId);
            case TYPE_URI:
                final String uriOrPath = inputStream.readUTF();
                return createWithContentUri(uriOrPath);
            case TYPE_URI_ADAPTIVE_BITMAP:
                final String uri = inputStream.readUTF();
                return createWithAdaptiveBitmapContentUri(uri);
        }
    }
    return null;
}