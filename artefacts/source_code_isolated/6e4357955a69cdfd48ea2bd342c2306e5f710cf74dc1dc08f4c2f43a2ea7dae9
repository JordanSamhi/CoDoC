public void saveInstanceState(Parcel p){
    if (mUpdateCount > 0) {
        throw new IllegalStateException("Can't save state while updating");
    }
    mStateSeq++;
    if (mStateSeq <= 0) {
        mStateSeq = 0;
    }
    mNextSavedIdx = 0;
    p.writeInt(mHistorySize);
    p.writeInt(mOwners.size());
    int i = mUndos.size();
    while (i > 0) {
        p.writeInt(1);
        i--;
        mUndos.get(i).writeToParcel(p);
    }
    i = mRedos.size();
    while (i > 0) {
        p.writeInt(2);
        i--;
        mRedos.get(i).writeToParcel(p);
    }
    p.writeInt(0);
}