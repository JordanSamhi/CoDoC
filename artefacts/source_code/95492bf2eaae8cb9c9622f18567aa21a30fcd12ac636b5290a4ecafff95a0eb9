public int dispatchInputEvent(InputEvent event, Object token, FinishedInputEventCallback callback, Handler handler){
    synchronized (mH) {
        if (mCurMethod != null) {
            if (event instanceof KeyEvent) {
                KeyEvent keyEvent = (KeyEvent) event;
                if (keyEvent.getAction() == KeyEvent.ACTION_DOWN && keyEvent.getKeyCode() == KeyEvent.KEYCODE_SYM && keyEvent.getRepeatCount() == 0) {
                    showInputMethodPickerLocked();
                    return DISPATCH_HANDLED;
                }
            }
            if (DEBUG)
                Log.v(TAG, "DISPATCH INPUT EVENT: " + mCurMethod);
            PendingEvent p = obtainPendingEventLocked(event, token, mCurId, callback, handler);
            if (mMainLooper.isCurrentThread()) {
                return sendInputEventOnMainLooperLocked(p);
            }
            Message msg = mH.obtainMessage(MSG_SEND_INPUT_EVENT, p);
            msg.setAsynchronous(true);
            mH.sendMessage(msg);
            return DISPATCH_IN_PROGRESS;
        }
    }
    return DISPATCH_NOT_HANDLED;
}