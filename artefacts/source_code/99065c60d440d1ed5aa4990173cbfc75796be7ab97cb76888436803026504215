public boolean addPreference(Preference preference){
    if (mPreferenceList.contains(preference)) {
        return true;
    }
    if (preference.getOrder() == Preference.DEFAULT_ORDER) {
        if (mOrderingAsAdded) {
            preference.setOrder(mCurrentPreferenceOrder++);
        }
        if (preference instanceof PreferenceGroup) {
            ((PreferenceGroup) preference).setOrderingAsAdded(mOrderingAsAdded);
        }
    }
    if (!onPrepareAddPreference(preference)) {
        return false;
    }
    synchronized (this) {
        int insertionIndex = Collections.binarySearch(mPreferenceList, preference);
        if (insertionIndex < 0) {
            insertionIndex = insertionIndex * -1 - 1;
        }
        mPreferenceList.add(insertionIndex, preference);
    }
    preference.onAttachedToHierarchy(getPreferenceManager());
    preference.assignParent(this);
    if (mAttachedToActivity) {
        preference.onAttachedToActivity();
    }
    notifyHierarchyChanged();
    return true;
}