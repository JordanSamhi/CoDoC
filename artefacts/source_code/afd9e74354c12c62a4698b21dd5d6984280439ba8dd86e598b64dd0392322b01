public void setUserVisibleHint(boolean isVisibleToUser){
    boolean useBrokenAddedCheck = false;
    Context context = getContext();
    if (mFragmentManager != null && mFragmentManager.mHost != null) {
        context = mFragmentManager.mHost.getContext();
    }
    if (context != null) {
        useBrokenAddedCheck = context.getApplicationInfo().targetSdkVersion <= VERSION_CODES.M;
    }
    final boolean performDeferredStart;
    if (useBrokenAddedCheck) {
        performDeferredStart = !mUserVisibleHint && isVisibleToUser && mState < STARTED && mFragmentManager != null;
    } else {
        performDeferredStart = !mUserVisibleHint && isVisibleToUser && mState < STARTED && mFragmentManager != null && isAdded();
    }
    if (performDeferredStart) {
        mFragmentManager.performPendingDeferredStart(this);
    }
    mUserVisibleHint = isVisibleToUser;
    mDeferStart = mState < STARTED && !isVisibleToUser;
}