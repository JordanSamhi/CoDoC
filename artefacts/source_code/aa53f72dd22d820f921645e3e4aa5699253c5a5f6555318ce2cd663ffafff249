public void setListener(SipAudioCall.Listener listener, boolean callbackImmediately){
    mListener = listener;
    try {
        if ((listener == null) || !callbackImmediately) {
        } else if (mErrorCode != SipErrorCode.NO_ERROR) {
            listener.onError(this, mErrorCode, mErrorMessage);
        } else if (mInCall) {
            if (mHold) {
                listener.onCallHeld(this);
            } else {
                listener.onCallEstablished(this);
            }
        } else {
            int state = getState();
            switch(state) {
                case SipSession.State.READY_TO_CALL:
                    listener.onReadyToCall(this);
                    break;
                case SipSession.State.INCOMING_CALL:
                    listener.onRinging(this, getPeerProfile());
                    break;
                case SipSession.State.OUTGOING_CALL:
                    listener.onCalling(this);
                    break;
                case SipSession.State.OUTGOING_CALL_RING_BACK:
                    listener.onRingingBack(this);
                    break;
            }
        }
    } catch (Throwable t) {
        loge("setListener()", t);
    }
}