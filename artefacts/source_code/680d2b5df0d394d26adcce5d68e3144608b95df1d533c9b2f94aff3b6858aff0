public int read(ByteBuffer buffer) throws IOException{
    if (buffer.isDirect()) {
        return native_read_direct(buffer, buffer.remaining());
    } else if (buffer.hasArray()) {
        return native_read_array(buffer.array(), buffer.remaining());
    } else {
        throw new IllegalArgumentException("buffer is not direct and has no array");
    }
}