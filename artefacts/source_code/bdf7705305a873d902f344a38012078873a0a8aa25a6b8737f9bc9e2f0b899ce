public int getStorageEncryptionStatus(@Nullable String callerPackage, int userHandle){
    if (!mHasFeature) {
    }
    enforceFullCrossUsersPermission(userHandle);
    ensureCallerPackage(callerPackage);
    final ApplicationInfo ai;
    try {
        ai = mIPackageManager.getApplicationInfo(callerPackage, 0, userHandle);
    } catch (RemoteException e) {
        throw new SecurityException(e);
    }
    boolean legacyApp = false;
    if (ai.targetSdkVersion <= Build.VERSION_CODES.M) {
        legacyApp = true;
    }
    final int rawStatus = getEncryptionStatus();
    if ((rawStatus == DevicePolicyManager.ENCRYPTION_STATUS_ACTIVE_PER_USER) && legacyApp) {
        return DevicePolicyManager.ENCRYPTION_STATUS_ACTIVE;
    }
    return rawStatus;
}